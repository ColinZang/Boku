"use strict";angular.module("myApp",["ngTouch"]).controller("Ctrl",["$window","$scope","$log","$timeout","gameService","hexagon","resizeGameAreaService",function(a,b,c,d,e,f,g){function h(a){b.board=a.stateAfterMove.board,b.delta=a.stateAfterMove.delta,void 0===b.board&&(b.board=w()),f.drawHexGrid(x,30,30,!1,b.board),console.log("board"+b.board),b.isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,b.turnIndex=a.turnIndexAfterMove,f.turn=a.yourPlayerIndex,b.isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&d(j,500)}function i(a){c.info(["Making move:",a]),e.makeMove(a)}function j(){var a=createComputerMove(b.board,b.turnIndex);e.makeMove(a),f.column=a[2].set.value.col-a[2].set.value.row+5,f.row=parseInt((-4+f.column+2*a[2].set.value.row)/2,10)}function k(a,c,d){if(""===l(b.board)){var e=m(c,d).x,g=m(c,d).y;if("touchstart"===a||"touchmove"===a){if(e===A&&g===B||-1===e&&-1===g)return;A=e,B=g;var h=0===b.turnIndex?"R":"Y";""===b.board[e][g]?(b.board[e][g]=h,f.drawHexGrid(x,30,30,!1,b.board),b.board[A][B]=""):f.drawHexGrid(x,30,30,!1,b.board)}else"touchend"==a&&(-1===e&&-1===g&&(e=A,g=B),n(e,g))}}function l(a){var b,c,d,e=5,f=[[0,5],[0,6],[0,7],[0,8],[0,9],[0,10],[1,10],[2,10],[3,10],[4,10],[5,10]],g=[[0,6],[0,7],[0,8],[0,9],[0,10],[1,11],[2,11],[3,11],[4,11],[5,11]],h=[[0,4],[0,3],[0,2],[0,1],[0,0],[1,0],[2,0],[3,0],[4,0],[5,0]];for(b=0;11>b;++b)for(c=0,d=f[b][0];d<f[b][1];++d)if(""!==a[b][d]&&(0===d||a[b][d-1]===a[b][d]?c++:c=1,c===e))return a[b][d];for(d=0;10>d;++d)for(c=0,b=g[d][0];b<g[d][1];++b)if(""!==a[b][d]&&(0===b||a[b-1][d]===a[b][d]?c++:c=1,c===e))return a[b][d];var i,j;for(b=0;10>b;++b)for(c=0,i=h[b][0],j=h[b][1];11>i&&10>j;i++,j++)if(""!==a[i][j]&&(0===i||0===j||a[i][j]===a[i-1][j-1]?c++:c=1,c===e))return a[i][j];return""}function m(b,c){var d=a.innerWidth,e=a.innerHeight,f=(b-(d/2-e/2))/e,g=c/e;console.log("xp"+f),console.log("yp"+g);for(var h,i,j=-1,k=-1,l=.075;.72>l;){if(f>l&&l+.05>f){if(h=Math.floor((f-.075)/.07),5>=h){i=Math.floor((g-(.3-.04*h))/.08),k=i,j=k+(5-h);break}i=Math.floor((g-(.1+.04*(h-5)))/.08),j=i,k=j+(h-5);break}l+=.07}return console.log("row"+j),console.log("col"+k),{x:j,y:k}}function n(a,d){try{var e=r(b.board,a,d,0,0,0,b.turnIndex);b.isYourTurn=!1,console.log(e),i(e)}catch(f){return void c.info(["Invalid move:",a,d,f.message])}}function o(a,b){return JSON.stringify(a)===JSON.stringify(b)}function p(a){return JSON.parse(JSON.stringify(a))}function q(a){var b,c;for(b=0;11>b;++b)for(c=x[b][0];c<x[b][1];++c)if(""===a[b][c])return!1;return!0}function r(a,b,c,d,e,f,g){if(void 0===a&&(a=w()),""!==a[b][c])throw new Error("One can only make a move in an empty position!");var h=p(a);h[b][c]=0===g?"R":"Y",0!==f&&(h[b+d*f][c+e*f]="");var i,j=l(h);return""!==j||q(h)?(console.log("Game over"),y=!0,i={endMatch:{endMatchScores:"R"===j?[1,0]:"Y"===j?[0,1]:[0,0]}}):i={setTurn:{turnIndex:1-g}},[i,{set:{key:"board",value:h}},{set:{key:"delta",value:{row:b,col:c,delDirRow:d,delDirCol:e,delDis:f}}}]}function s(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{{var e=b[2].set.value,f=e.row,g=e.col,h=e.delDirRow,i=e.delDirCol,j=e.delDis,k=d.board,l=(d.row,d.col,d.delDis);d.delDirRow,d.delDirCol}if(void 0===k&&(k=w()),0!==j&&0!==l&&h===f&&i===g)return!1;if(0!==j){if(j>2||0>j)return!1;if(0>f+3*h||0>g+3*i)return!1;if(k[f+h][g+i]!==(0===c?"Y":"R"))return!1;if(k[f+2*h][g+2*i]!==(0===c?"Y":"R"))return!1;if(k[f+3*h][g+3*i]!==(0===c?"R":"Y"))return!1}var m=r(k,f,g,h,i,j,c);if(!o(b,m))return!1;if(0>f||f>10)return!1;if(x[f][0]>g||x[f][1]<=g)return!1}catch(n){return!1}return!0}function t(a,b,c){for(var d=[],e=b,f=a,g=0;g<c.length;g++){var h=c[g],i=r(e.board,h.row,h.col,h.delDirRow,h.delDirCol,h.delDis,f),j={board:i[1].set.value,delta:i[2].set.value};d.push({stateBeforeMove:e,stateAfterMove:j,turnIndexBeforeMove:f,turnIndexAfterMove:1-f,move:i,comment:{en:h.comment}}),e=j,f=1-f}return d}function u(){return t(0,{},[{row:5,col:5,delDirRow:0,delDirCol:0,delDis:0,comment:"R put at middle of the board"},{row:5,col:6,delDirRow:0,delDirCol:0,delDis:0,comment:"Y put next to it(trying to block it)"},{row:4,col:5,delDirRow:0,delDirCol:0,delDis:0,comment:"R put one on it's neighbor to form two in a row"},{row:3,col:5,delDirRow:0,delDirCol:0,delDis:0,comment:"Y tries to block one side of R"},{row:4,col:6,delDirRow:0,delDirCol:0,delDis:0,comment:"R forms another line on another direction"},{row:3,col:7,delDirRow:0,delDirCol:0,delDis:0,comment:"Y blocks one side of R's new line"},{row:6,col:4,delDirRow:0,delDirCol:0,delDis:0,comment:"R extends the line by adding one on the other direction"},{row:7,col:3,delDirRow:0,delDirCol:0,delDis:0,comment:"Y blocks the other direction as well"}])}function v(){var a=w();return a[5][3]="R",a[5][4]="R",a[5][5]="R",a[6][7]="Y",a[6][3]="Y",a[1][3]="Y",a[4][4]="Y",[t(0,{board:a,delta:{row:4,col:4,delDirRow:0,delDirCOl:0,delDis:0}},[{row:5,col:6,delDirRow:0,delDirCol:0,delDis:0,comment:"Find the position for R where he could win in his next turn at either side of a 4-in-a-row line"},{row:5,col:7,delDirRow:0,delDirCol:0,delDis:0,comment:"Y played at the right end"},{row:5,col:2,delDirRow:0,delDirCol:0,delDis:0,comment:"R wins by having three R at the right side of the line."}])]}function w(){var a,b,c=new Array(11);for(a=0;11>a;++a)for(c[a]=new Array(10),b=x[a][0];b<x[a][1];++b)c[a][b]="";return console.log("board"+c),c}g.setWidthToHeight(1);var x=[[0,5],[0,6],[0,7],[0,8],[0,9],[0,10],[1,10],[2,10],[3,10],[4,10],[5,10]],y=!1;console.log("b4"),b.board=w(),console.log("after"),f.HexagonGrid("HexCanvas",50),h({stateAfterMove:{},turnIndexAfterMove:0,yourPlayerIndex:-2}),b.cellClicked=function(a){if(console.log("x,y",a),b.isYourTurn){console.log("changed x"+a.clientX-z.offsetLeft);var c=m(a.clientX,a.clientY);n(c.x,c.y)}};var z=document.getElementById("gameArea"),A=null,B=null;window.handleDragEvent=k;var C=w();C[0][0]="R";var D=p(C);D[0][1]="Y",console.log([s({turnIndexBeforeMove:0,stateBeforeMove:{},move:[{setTurn:{turnIndex:1}},{set:{key:"board",value:C}},{set:{key:"delta",value:{row:0,col:0,delDirRow:0,delDirCol:0,delDis:0}}}]}),s({turnIndexBeforeMove:1,stateBeforeMove:{board:C,delta:{row:0,col:0,delDirRow:0,delDirCol:0,delDis:0}},move:[{setTurn:{turnIndex:0}},{set:{key:"board",value:D}},{set:{key:"delta",value:{row:0,col:1,delDirRow:0,delDirCol:0,delDis:0}}}]}),s({turnIndexBeforeMove:0,stateBeforeMove:{},move:[{setTurn:{turnIndex:0}}]})]),this.createComputerMove=function(a,b){var c,d,e=[];for(c=0;11>c;c++)for(d=x[c][0];d<x[c][1];d++)try{e.push(r(a,c,d,0,0,0,b))}catch(f){}var g=e[Math.floor(Math.random()*e.length)];return console.log("random move is: ",g[2].set.value.row,g[2].set.value.col),g},e.setGame({gameDeveloperEmail:"ycy247@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,exampleGame:u(),riddles:v(),isMoveOk:s,updateUI:h})}]),angular.module("myApp").service("hexagon",function(){function a(c,d,e,f){var g=(new Date).getTime(),h=g-e;if(!(h>500)){var i;"R"==f?i="rgb("+parseInt(255*h/500,10)+",0,0)":"Y"==f&&(i="rgb("+parseInt(255*h/500,10)+","+parseInt(255*h/500,10)+",0)"),b.drawHex(c,d,i,!1),requestAnimFrame(function(){a(c,d,e,f)})}}var b=this;this.HexagonGrid=function(a,c){b.radius=c,console.log(a),b.height=Math.sqrt(3)*c,b.width=2*c,b.side=1.5*c,b.canvas=document.getElementById(a),b.context=b.canvas.getContext("2d"),b.canvasOriginX=0,b.canvasOriginY=0},this.drawHexGrid=function(c,d,e,f,g){b.canvasOriginX=d,b.canvasOriginY=e;for(var h,i,j="",k=!1,l=0;12>l;l++){for(var m=0;12>m;m++){var n=parseInt((5-l+2*m)/2,10);0>5-l+2*m&&(n=1e3);var o=n+l-5;k?(h=l*b.side+d,i=m*b.height+e+.5*b.height):(h=l*b.side+d,i=m*b.height+e),f&&(j=i),n>=0&&11>n&&("R"!=g[n][o]&&"Y"!=g[n][o]&&""!=g[n][o]||m!=b.row||l!=b.column?"R"==g[n][o]?b.drawHex(h,i,"#000000",j):"Y"==g[n][o]?b.drawHex(h,i,"#FFFFFF",j):""==g[n][o]&&b.drawHex(h,i,"#999999",j):(a(h,i,(new Date).getTime(),g[n][o]),b.row=-1,b.column=-1))}k=!k}},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),this.drawHexAtColRow=function(a,c,d){var e=a%2==0?c*b.height+b.canvasOriginY:c*b.height+b.canvasOriginY+b.height/2,f=a*b.side+b.canvasOriginX;b.drawHex(f,e,d,"")},this.drawHex=function(a,c,d,e){b.context.strokeStyle="#000",b.context.beginPath(),b.context.moveTo(a+b.width-b.side,c),b.context.lineTo(a+b.side,c),b.context.lineTo(a+b.width,c+b.height/2),b.context.lineTo(a+b.side,c+b.height),b.context.lineTo(a+b.width-b.side,c+b.height),b.context.lineTo(a,c+b.height/2),d&&(b.context.fillStyle=d,b.context.fill()),b.context.closePath(),b.context.stroke(),e&&(b.context.font="8px",b.context.fillStyle="#000",b.context.fillText(e,a+b.width/2-b.width/4,c+(b.height-5)))},this.getRelativeCanvasOffset=function(){for(var a=0,c=0,d=b.canvas;d.offsetParent;)a+=d.offsetLeft,c+=d.offsetTop,d=d.offsetParent;return b.offSetX=a,b.offSetY=c,{x:a,y:c}},this.getSelectedTile=function(a,c){var d=b.getRelativeCanvasOffset();console.log("mouse: ",a,c),a-=d.x,c-=d.y,a/=b.scale,c/=b.scale,a-=b.tx,c-=b.ty,a-=b.canvasOriginX,c-=b.canvasOriginY;var e=Math.floor(a/b.side),f=Math.floor(e%2==0?Math.floor(c/b.height):Math.floor((c+.5*b.height)/b.height)-1);if(a>e*b.side&&a<e*b.side+b.width-b.side){var g=new Object;g.x=e*b.side,g.y=e%2==0?f*b.height:f*b.height+b.height/2;var h=new Object;h.x=g.x,h.y=g.y+b.height/2;var i=new Object;i.x=g.x+b.width-b.side,i.y=g.y;var j=new Object;j.x=a,j.y=c,b.isPointInTriangle(j,g,h,i)&&(e--,e%2!=0&&f--);var k=new Object;k=h;var l=new Object;l.x=k.x,l.y=k.y+b.height/2;var m=new Object;m.x=l.x+(b.width-b.side),m.y=l.y,b.isPointInTriangle(j,k,l,m)&&(e--,e%2==0&&f++)}return{row:f,column:e}},this.sign=function(a,b,c){return(a.x-c.x)*(b.y-c.y)-(b.x-c.x)*(a.y-c.y)},this.isPointInTriangle=function(a,c,d,e){var f,g,h;return f=b.sign(a,c,d)<0,g=b.sign(a,d,e)<0,h=b.sign(a,e,c)<0,f==g&&g==h},this.getIndex=function(a,c){var d=a,e=c,f=b.getSelectedTile(d,e);b.column=f.column,b.row=f.row},this.updateUI=function(){if(b.column>=0&&b.row>=0){var a=b.column%2==0?b.row*b.height+b.canvasOriginY+6:b.row*b.height+b.canvasOriginY+6+b.height/2,c=b.column*b.side+b.canvasOriginX;1===b.turn?b.drawHex(c,a-6,"rgba(255,0,0,0.4)",""):b.drawHex(c,a-6,"rgba(255,255,0,0.4)","")}}});
//# sourceMappingURL=everything.min.js.map